(self.webpackChunkcloud_trade_sdk=self.webpackChunkcloud_trade_sdk||[]).push([[9837],{7089:(t,e,n)=>{"use strict";n.d(e,{X:()=>T});var a=n(2784),i=n(42950),s=n.n(i),p=n(89201),u=n(6391),o=n.n(u),r=n(23332);const y=[{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"uint256",name:"amount0",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1",type:"uint256"},{indexed:!0,internalType:"address",name:"to",type:"address"}],name:"Burn",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"uint256",name:"amount0",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1",type:"uint256"}],name:"Mint",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"uint256",name:"amount0In",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1In",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount0Out",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1Out",type:"uint256"},{indexed:!0,internalType:"address",name:"to",type:"address"}],name:"Swap",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint112",name:"reserve0",type:"uint112"},{indexed:!1,internalType:"uint112",name:"reserve1",type:"uint112"}],name:"Sync",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{constant:!0,inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"MINIMUM_LIQUIDITY",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"PERMIT_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"to",type:"address"}],name:"burn",outputs:[{internalType:"uint256",name:"amount0",type:"uint256"},{internalType:"uint256",name:"amount1",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"factory",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getReserves",outputs:[{internalType:"uint112",name:"_reserve0",type:"uint112"},{internalType:"uint112",name:"_reserve1",type:"uint112"},{internalType:"uint32",name:"_blockTimestampLast",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_token0",type:"address"},{internalType:"address",name:"_token1",type:"address"}],name:"initialize",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"kLast",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"to",type:"address"}],name:"mint",outputs:[{internalType:"uint256",name:"liquidity",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"price0CumulativeLast",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"price1CumulativeLast",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"to",type:"address"}],name:"skim",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"amount0Out",type:"uint256"},{internalType:"uint256",name:"amount1Out",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"bytes",name:"data",type:"bytes"}],name:"swap",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"sync",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"token0",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"token1",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"}],l=[{constant:!1,inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],payable:!1,stateMutability:"pure",type:"function"}],d=r.Mt;var c=n(23716),m=function(t,e,n,a){return new(n||(n=Promise))((function(i,s){function p(t){try{o(a.next(t))}catch(t){s(t)}}function u(t){try{o(a.throw(t))}catch(t){s(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(p,u)}o((a=a.apply(t,e||[])).next())}))};class b{constructor(t,e,n,a){this.isUniswapV3=!1,this.web3=new(s())((t=>{switch(t){case"eth":return"https://mainnet.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161";case"arb":return"https://arb1.arbitrum.io/rpc";case"bnb":default:return"https://bsc-dataseed1.defibit.io"}})(t)),this.pair=e,this.base=n,this.quote=a}init(){return m(this,void 0,void 0,(function*(){yield Promise.all([this.initLPContract(this.pair),this.initUniswapV3PoolContract(this.pair),this.initBaseContract(this.base),this.initQuoteContract(this.quote)]).catch((t=>{c.error(t)})),yield this.detectUniswapVersion()}))}fetchPrice(){return m(this,void 0,void 0,(function*(){return this.isUniswapV3?this.fetchUniswapV3Price():this.fetchUniswapV2Price()}))}detectUniswapVersion(){return m(this,void 0,void 0,(function*(){try{yield this.uniswapV3PoolContract.methods.slot0().call(),this.isUniswapV3=!0}catch(t){this.isUniswapV3=!1}}))}initLPContract(t){return m(this,void 0,void 0,(function*(){this.lpContract=new this.web3.eth.Contract(y,t)}))}initUniswapV3PoolContract(t){return m(this,void 0,void 0,(function*(){this.uniswapV3PoolContract=new this.web3.eth.Contract(d,t)}))}initBaseContract(t){return m(this,void 0,void 0,(function*(){this.baseContract=new this.web3.eth.Contract(l,t)}))}initQuoteContract(t){return m(this,void 0,void 0,(function*(){this.quoteContract=new this.web3.eth.Contract(l,t)}))}fetchUniswapV2Price(){return m(this,void 0,void 0,(function*(){const[{_reserve0:t,_reserve1:e},n,a,i,s]=yield Promise.all([this.lpContract.methods.getReserves().call(),this.lpContract.methods.token0().call(),this.lpContract.methods.token1().call(),this.baseContract.methods.decimals().call(),this.quoteContract.methods.decimals().call()]),u=Number(i),r=Number(s),y=Number((0,p.fromWei)(n.toLowerCase()===this.quote.toLowerCase()?t:e,"ether")),l=Number((0,p.fromWei)(a.toLowerCase()===this.base.toLowerCase()?e:t,"ether"));let d=new(o())(l),c=new(o())(y);return u!==r&&(d=d.div(new(o())(Math.pow(10,u))),c=c.div(new(o())(Math.pow(10,r)))),0===l?0:c.div(d).toNumber()}))}fetchUniswapV3Price(){return m(this,void 0,void 0,(function*(){const[{sqrtPriceX96:t},e,n,a]=yield Promise.all([this.uniswapV3PoolContract.methods.slot0().call(),this.uniswapV3PoolContract.methods.token0().call(),this.baseContract.methods.decimals().call(),this.quoteContract.methods.decimals().call()]),i=new(o())(t).pow(2).dividedBy(new(o())(2).pow(192)),s=e.toLowerCase()===this.base.toLowerCase();return i.pow(s?1:-1).multipliedBy(new(o())(10).pow(Number(n)-Number(a))).toNumber()}))}}var h=n(23716),v=function(t,e,n,a){return new(n||(n=Promise))((function(i,s){function p(t){try{o(a.next(t))}catch(t){s(t)}}function u(t){try{o(a.throw(t))}catch(t){s(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(p,u)}o((a=a.apply(t,e||[])).next())}))};const T=({tokenNetwork:t="bnb",pair:e,base:n,quote:i})=>{const[s,p]=(0,a.useState)(null),[u,o]=(0,a.useState)(0),r=(0,a.useCallback)((()=>v(void 0,void 0,void 0,(function*(){if(s)try{const t=yield s.fetchPrice();o(t)}catch(t){h.error(t)}}))),[s]);return(0,a.useEffect)((()=>{v(void 0,void 0,void 0,(function*(){const a=new b(t,e,n,i);yield a.init(),p(a)}))}),[e,n,i,t]),(0,a.useEffect)((()=>{r();const t=setInterval(r,3e5);return()=>clearInterval(t)}),[r]),u}},37914:()=>{},1322:()=>{},29005:()=>{},45179:()=>{},50936:()=>{},70491:()=>{},93618:()=>{},87162:()=>{},42780:()=>{},43159:()=>{}}]);