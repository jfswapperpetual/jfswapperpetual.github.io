"use strict";(self.webpackChunkcloud_trade_sdk=self.webpackChunkcloud_trade_sdk||[]).push([[5145],{27657:(e,t,r)=>{r.d(t,{Q:()=>s});var n=r(11001),i=r(73121);const{coin:a,cont:o}=n.SW;function s(){const{unit:e}=(0,i.F7)();return{isCoinUnit:e===a,isContUnit:e===o}}},55145:(e,t,r)=>{r.r(t),r.d(t,{default:()=>E});var n=r(52322),i=r(2784),a=r(75486),o=r.n(a);const s=["header_widget","header_symbol_search","symbol_info","header_compare","header_chart_type","display_market_status","symbol_search_hot_key","border_around_the_chart","remove_library_container_border","symbol_info","header_interval_dialog_button","show_interval_dialog_on_key_press","volume_force_overlay","header_resolutions","legend_context_menu"];var c=r(49475),u=r(38896),l=r(59895),y=r(37127),m=r(12374),d=r(19614),p=(r(86067),r(23131)),v=r(97060),b=r(9205),f=r(11001),h=r(29261),k=r(73121),g=r(37227),T=r(35090),_=r(1633),M=r(65588),I=r(75020),D=r(4929),O=r(27657);const P=({symbol:e,type:t,priceType:r})=>`${e}@${t}@${r}`,S=e=>{const[t,r,n]=e.split("@");return{symbol:t,type:r,priceType:n}};var C=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))};const{brandName:w=""}=window.brokerConfig,x=[p.ls.TRADING,p.ls.DELIVERING];var j;!function(e){e.Futures="futures",e.FuturesMark="futures-mark",e.FuturesIndex="futures-index",e.Delivery="delivery",e.DeliveryMark="delivery-mark",e.DeliveryIndex="delivery-index"}(j||(j={}));const V=({ticker:e,name:t,productType:r,pricePrecision:n})=>({name:t,fullName:t,description:t,ticker:e,tickSize:Math.pow(10,n),exchange:w,supportedResolutions:c.k.DefaultResolutions,type:r});var F=r(54163);var $=r(23716),L=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))};const R=(e,t)=>{[y.sy,y.O7].map((e=>o().createInstance({name:e}))).forEach((r=>r.setItem(t,e)))},E=({symbol:e,namespace:t,useMiniTicker:r=!1})=>{const a=c.k.Store.createStore(t),[p,E]=(0,i.useState)(1),A=a(c.k.Store.getTrueInterval),[q]=a(c.k.Store.getPriceType),B=(0,u.Vh)(),{contractType:U}=B[e]||{},{datafeed:N,symbolsInfo:H}=(({namespace:e,useMiniTicker:t=!1})=>{const r=c.k.Store.createStore(e),{getI18n:n}=(0,v.ZK)("trd-chart","trade-ui"),{getI18n:a}=(0,v.yk)(),o=(0,u.Vh)(),s=(0,i.useRef)(o),{isContUnit:l}=(0,O.Q)(),y=(0,u._n)(),[m]=r(c.k.Store.getPriceType),d=(0,i.useRef)(y),p=(0,i.useRef)(m);s.current=o,d.current=y,p.current=m;const b=(0,i.useMemo)((()=>l?D.D:D.V),[l]),f=(0,i.useMemo)((()=>a("usdtFutures-13",{defaultValue:"Futures"})||""),[a]),h=(0,i.useMemo)((()=>a("inverseFutures-13",{defaultValue:"Delivery"})||""),[a]),k=(0,i.useMemo)((()=>n("indexPrice",{defaultValue:"Index Price"})||""),[n]),F=(0,i.useMemo)((()=>n("markPrice",{defaultValue:"Mark Price"})||""),[n]),$=(0,i.useMemo)((()=>n("lastPrice",{defaultValue:"Last Price"})||""),[n]),L=(0,i.useMemo)((()=>({exchanges:[{name:w,value:w,desc:""}],symbols_types:[{name:f,value:j.Futures},{name:`${f} ${F}`,value:j.FuturesMark},{name:`${f} ${k}`,value:j.FuturesIndex}]})),[h,f,k,F]),R=(0,i.useCallback)((()=>C(void 0,void 0,void 0,(function*(){try{yield(({checker:e,interval:t=1e3,timeout:r=1e4})=>{let n;return Promise.race([new Promise((r=>{n=setInterval((()=>e()&&r()),t)})),new Promise(((e,t)=>{setTimeout((()=>t(new Error("timeout"))),r)}))]).finally((()=>clearInterval(n)))})({checker:()=>Object.keys(s.current).length>0})}catch(e){}const e=s.current;return Object.keys(e).reduce(((t,r)=>{const{symbol:n,pricePrecision:i,isDelivery:o,contractStatus:s,contractType:u}=e[r];if(!x.includes(s))return t;const{symbol:l,contractTypeI18n:y,deliveryDateFormat:m}=(0,g.H)(e[r],a),d=`${l} ${y}${m?` ${m}`:""}`,p=P({symbol:n,type:u,priceType:c.k.Store.PriceType.Last}),v=P({symbol:n,type:u,priceType:c.k.Store.PriceType.Index}),b=P({symbol:n,type:u,priceType:c.k.Store.PriceType.Mark});return t[p]=V({ticker:p,name:`${d} ${$}`,productType:o?j.Delivery:j.Futures,pricePrecision:i}),t[v]=V({ticker:v,name:`${d} ${k}`,productType:o?j.DeliveryIndex:j.FuturesIndex,pricePrecision:i}),t[b]=V({ticker:b,name:`${d} ${F}`,productType:o?j.DeliveryMark:j.FuturesMark,pricePrecision:i}),t}),{})}))),[a,k,F,$]),E=(0,i.useCallback)((({symbolInfo:e,resolution:t,rangeStartDate:r,rangeEndDate:n})=>C(void 0,void 0,void 0,(function*(){const i=s.current,{symbol:a="",priceType:o=p.current}=S(e.ticker||""),{pair:u,contractType:l,contractVal:y,isDelivery:m}=i[a],d=Math.max(0,1e3*r),v=1e3*n,f=c.k.utils.TVResolutionToTrueInterval[t],h=m?b(y):e=>e,k=(0,I.b)({symbol:a,pair:u,contractType:l,interval:f,isDelivery:m,priceType:o});return(yield(0,M.M)({onFetchKlineData:k,startTime:d,endTime:v})).map(h)}))),[b]),A=(0,i.useCallback)((({symbolInfo:e,resolution:r,callback:n})=>{const i=s.current,{symbol:a="",priceType:o=p.current}=S(e.ticker||""),{pair:u,contractType:l,contractVal:y,isDelivery:m}=i[a],d=c.k.utils.TVResolutionToTrueInterval[r],v=m?b(y):e=>e;return(0,_.Ld)({symbol:a,pair:u,contractType:l,interval:d,priceType:o,isDelivery:m,useMiniTicker:t,checkIfInSync:()=>!0,callback:e=>n(v(e))})}),[b,t]),q=(0,i.useCallback)((()=>C(void 0,void 0,void 0,(function*(){const{serverTime:e}=yield(0,T.b)(!0);return Math.floor(parseInt(`${e}`,10)/1e3)}))),[]),B=(0,i.useMemo)((()=>c.k.createDatafeed()),[]),{datafeed:U,symbolsInfo:N}=B({config:L,onFetchSymbolsInfo:R,onFetchBars:E,onSubscribeBars:A,onFetchServerTimeApi:q});return{datafeed:U,symbolsInfo:N}})({namespace:t,useMiniTicker:r}),Q=(0,u.Fg)(),K="light"===Q?d.ib:d.Cs,W=(0,m.k)(Q),G=(0,i.useMemo)((()=>o().createInstance({name:t})),[t]),Y=(e=>{switch(e){case y.g8.IndexPrice:return"ipTradingView";case y.g8.MarkPrice:return"mpTradingView";default:return"myTradingView"}})(q),X=(0,i.useMemo)((()=>`${t}-${y.P7}_${Y}_${K}`),[t,Y,K]),Z=(0,i.useMemo)((()=>P({symbol:e,type:U,priceType:q})),[e,U,q]),z=(0,i.useRef)(-1),{executionOrders:J}=(({symbol:e,namespace:t})=>{const r=c.k.OrderHistoryStore.createStore(t),[n]=r(c.k.OrderHistoryStore.getOrderHistory),{getI18n:a}=(0,v.KL)(),o=(({symbol:e})=>{const{getI18n:t}=(0,b.yk)(),r=(0,h.AM)(),{baseAsset:n,marginAsset:i,isDelivery:a}=r[e]||{},{unit:o}=(0,k.F7)();return a?o===f.SW.coin?n:t("Cont"):o===f.AO.usdt?i:n})({symbol:e}),s=(0,u.AM)(),{baseAsset:l,pricePrecision:y,quantityPrecision:m,equalQtyPrecision:d,isDelivery:p,contractVal:g}=s[e]||{},T=(0,i.useMemo)((()=>a("openOrder-sideBuyBOTH",{defaultValue:"Buy"})||""),[a]),_=(0,i.useMemo)((()=>a("openOrder-sideSellBOTH",{defaultValue:"Sell"})||""),[a]),M=(0,i.useMemo)((()=>{switch(o){case l:return p?d:m;default:return p?m:y}}),[p,o,l,d,y,m]),I=(0,i.useCallback)((({avgPrice:e,executedQty:t})=>p?(0,F.GW)(o===l?(({price:e,cont:t,contractVal:r})=>t*r/e)({price:e,cont:t,contractVal:g}):t,M):(0,F.mD)(o===l?t:t*e,M)),[l,g,p,M,o]);return{executionOrders:(0,i.useMemo)((()=>n.filter((({status:e,executedQty:t})=>"FILLED"===e.toUpperCase()||"PARTIAL FILL"===e.toUpperCase()||"PARTIALLY_FILLED"===e.toUpperCase()||"EXPIRED"===e.toUpperCase()&&t>0||"CANCELED"===e.toUpperCase()&&t>0)).map((({id:e,avgPrice:t,side:r,time:n,executedQty:i})=>{const a=`${"BUY"===r?T:_} ${I({avgPrice:t,executedQty:i})} @ ${(+t).toFixed(y)}`;return{id:e,text:"",price:+t,quantity:"",time:Math.round(n/1e3),isBuy:"BUY"===r,tooltip:a}}))),[n,T,_,I,y])}})({symbol:e,namespace:t});(0,l.M)(e,r),(0,l.j)({symbol:e,interval:A,priceType:q});const ee=(0,i.useCallback)((()=>{z.current=Date.now()}),[]),te=(0,i.useCallback)((e=>L(void 0,void 0,void 0,(function*(){return R(e,Y)}))),[Y]),re=(0,i.useCallback)((()=>{}),[]),ne=(0,i.useCallback)((()=>L(void 0,void 0,void 0,(function*(){const e=yield G.getItem(Y);R(e,Y)}))),[G,Y]),ie=(0,i.useCallback)((e=>$.log("tv-error",e)),[]),ae=(0,i.useCallback)((()=>{}),[]),oe=(0,i.useCallback)((()=>{}),[]),se=(0,i.useMemo)((()=>q===y.g8.LastPrice?s:[...s,"create_volume_indicator_by_default","create_volume_indicator_by_default_once"]),[q]),ce=(0,i.useCallback)((()=>G.removeItem(Y)),[G,Y]);return(0,i.useEffect)((()=>{E((e=>-1*e))}),[q]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(c.k.Containers.TradingView,{namespace:t,theme:K,storageName:Y,tradingViewProps:{symbol:Z,symbolsInfo:H,theme:W,limitOrders:[],positionOrders:[],executionOrders:J,initialConfig:{tvConfig:{container_id:X,library_path:"charting_library_next/",symbol:Z,theme:W,datafeed:N,disabled_features:se},onScriptLoaded:ee,onSave:te,onChartReadyDone:re,onWillUnmount:ne,onCreateOrderShapesError:ie,onFirstTimeDataLoadedDone:ae,onSetThemeDone:oe}},errorBoundaryProps:{name:"trading_view",onReset:ce}},`tv-${p}`)},void 0)}},59895:(e,t,r)=>{r.d(t,{j:()=>s,M:()=>c});var n=r(2784),i=r(49475),a=r(23131),o=r(29261);const s=({symbol:e,interval:t,priceType:r})=>{const{pair:s,contractType:c,isDelivery:u}=(0,o.Vh)()[e]||{},l=(0,n.useRef)();(0,n.useEffect)((()=>{if(!s||!c)return()=>null;const n="mark"===r?e:s;return l.current=void 0,i.k.utils.intervalToMillseconds(t),(u?(0,a.RU)():(0,a.BN)()).getContinuousKlineStream(n,c,t,{priceType:r,symbol:e}).subscribe((e=>{l.current&&(e.time,l.current.time),l.current=e}))}),[s,e,t,c,r,u])},c=(e,t)=>{const{isDelivery:r}=(0,o.Vh)()[e]||{},i=(0,n.useRef)();(0,n.useEffect)((()=>t?()=>null:(r?(0,a.RU)():(0,a.BN)()).getStreamTradeSnap(e).subscribe((e=>{const t=e[e.length-1];i.current&&(t.tradeTime,i.current.tradeTime),i.current=t}))),[r,e,t])}},75020:(e,t,r)=>{r.d(t,{b:()=>i});var n=r(95226);const i=({symbol:e,pair:t,contractType:r,interval:i,isDelivery:a,priceType:o})=>s=>a&&"last"===o?(0,n.kV)(Object.assign(Object.assign({},s),{pair:t,contractType:r,interval:i})):a&&"mark"===o?(0,n.uX)(Object.assign(Object.assign({},s),{symbol:e,interval:i})):a&&"index"===o?(0,n.te)(Object.assign(Object.assign({},s),{pair:t,interval:i})):"mark"===o?(0,n.C1)(Object.assign(Object.assign({},s),{symbol:e,interval:i})):"index"===o?(0,n.hH)(Object.assign(Object.assign({},s),{pair:t,interval:i})):(0,n.MZ)(Object.assign(Object.assign({},s),{pair:t,contractType:r,interval:i}))},65588:(e,t,r)=>{r.d(t,{M:()=>n});const n=({onFetchKlineData:e,startTime:t,endTime:r,limit:n=1e3})=>{return i=void 0,a=void 0,s=function*(){const i=[];let a=[],o=r;const s=0!==r;do{if(a=yield e(Object.assign(Object.assign({},0===o?{}:{endTime:o}),{limit:n})),0===a.length)break;a.forEach((([e,t,r,n,a,o,,s])=>{i.push({time:+e,open:+t,high:+r,low:+n,close:+a,volume:+o,quantity:+s})})),o=a[0][0]-1}while(a.length===n&&o>t&&s);return i.sort(((e,t)=>e.time-t.time)),i},new((o=void 0)||(o=Promise))((function(e,t){function r(e){try{c(s.next(e))}catch(e){t(e)}}function n(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof o?i:new o((function(e){e(i)}))).then(r,n)}c((s=s.apply(i,a||[])).next())}));var i,a,o,s}},4929:(e,t,r)=>{r.d(t,{D:()=>i,V:()=>n});const n=e=>t=>Object.assign(Object.assign({},t),{volume:t.quantity,quantity:t.volume*e}),i=e=>t=>Object.assign(Object.assign({},t),{volume:t.volume,quantity:t.volume*e})},1633:(e,t,r)=>{r.d(t,{Ld:()=>c});var n=r(49475),i=r(23131),a=r(23716);const o=e=>e,s=e=>e,c=({symbol:e,pair:t,contractType:r,interval:c,priceType:u,isDelivery:l,useMiniTicker:y,callback:m,checkIfInSync:d=(()=>!0)})=>{const p=(0,i.BN)(),v="mark"===u?e:t,b=p.getContinuousKlineStream(v,r,c,{priceType:u,symbol:e});b.selector=o;const f=y?p.getStreamTickers():p.getStreamTradeSnap(e);f.selector=y?(e=>t=>t[e])(e):s;const h=function(e=[]){const t=[];function r(){t.forEach((e=>e()))}return r.subscribe=function(r){const n=[];e.forEach(((e,i)=>{const a=e.subscribe((t=>{n[i]=e.selector(t),r(n)}));t.push(a)}))},r}([b,f]);return h.subscribe((([e,t])=>{if(!t||!e||!d())return;const r=Object.assign({},e);if("last"===u){const e=Array.isArray(t)?t.slice(-1).pop():t,i=n.k.utils.intervalToMillseconds(c),o=+(e.price||e.lastPrice),s=+(e.quantity||e.quoteVolume),u=e.tradeTime||e.eventTime;try{if("1M"===c){const e=new Date(u),t=new Date(r.time).getMonth();if(e.getMonth()>t){const e=+new Date(r.time).setMonth(t+1);Object.assign(r,Object.assign({time:e,open:o,high:o,low:o,close:o},y?{volume:0,quantity:0}:{volume:s,quantity:s}))}}else if(u-r.time>i){const e=r.time+Math.floor((u-r.time)/i)*i;Object.assign(r,Object.assign({time:e,open:o,high:o,low:o,close:o},y?{volume:0,quantity:0}:{volume:s,quantity:s}))}}catch(e){a.error(e)}r.close=o}m(r,e)})),h}}}]);